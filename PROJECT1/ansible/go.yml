---
## This playbook deploys the whole application stack in this site.

# Apply common configuration to all hosts
- hosts: all
  become: true
  gather_facts: yes
  vars_files:
    - ./vars.yml
  roles:
    - provision
  #- monitoring-node
  tags:
  - provision

# Base configure database servers.
- hosts: db
  become: true
  vars_files:
    - ./vars.yml
  roles:
    - provision-db
  tags:
  - provision-db

# Configure replication DB Master-Slave  
- hosts: db
  become: true
  vars_files:
    - ./vars.yml
  roles:
    - replicate-db
  tags:
  - replicate-db

# Database NEXTCLOUD
- hosts: db_main
  become: true
  vars_files:
    - ./vars.yml
  roles:
    - nextcloud-db
  tags:
  - nextcloud-db

# Configure application hosts
- hosts: app
  become: true
  vars_files:
    - ./vars.yml
  roles:
    - app
  tags:
  - app

# Cofigure Front
- hosts: front
  become: true
  vars_files:
    - ./vars.yml
  roles:
    - front
  tags:
  - front
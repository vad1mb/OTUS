# Домашнее задание 10. Написать скрипт на языке Bash.

## Задание

Написать скрипт для CRON, который раз в час будет формировать письмо и отправлять на заданную почту.

Необходимая информация в письме:

- Список IP адресов (с наибольшим кол-вом запросов) с указанием кол-ва запросов c момента последнего запуска скрипта;
- Список запрашиваемых URL (с наибольшим кол-вом запросов) с указанием кол-ва запросов c момента последнего запуска скрипта;
- Ошибки веб-сервера/приложения c момента последнего запуска;
- Список всех кодов HTTP ответа с указанием их кол-ва с момента последнего запуска скрипта.
- Скрипт должен предотвращать одновременный запуск нескольких копий, до его завершения.
- В письме должен быть прописан обрабатываемый временной диапазон.

# Решение

### Некоторые отступления и условности

За неимением под рукой сервиса httpd (Apache), где можно было бы взять log-файлы, используем предоставленный log-файл для отработки действий.

Отправка реального письма имеет некоторые сложности, поэтому представлена только команда, которая должна быть при реализации рабочей схемы.

---

**script.sh** необходимо разместить в определенном месте, например /usr/local/bin, проверить права на выполнение.

log - файл размещаем в какой-либо директории (пусть будет /home/vagrant/) и указываем его в скрипте как *DIR_DATA*. Само имя log-файла указываем в *access_log*.

`crontab -e` - добавляем задание в cron

```jsx
0 * * * * /usr/local/bin/script.sh
```

В результате выполнения скрипта по расписанию будет формироваться файл следующего содержания:

```jsx
Временной диапазон лог-файла
--------------------------------------------------
17/May/2015:10:05:03
20/May/2015:21:05:15

Top 10 IP-адресов с наибольшим кол-вом запросов
--------------------------------------------------
    482 66.249.73.135
    364 46.105.14.53
    357 130.237.218.86
    273 75.97.9.59
    113 50.16.19.13
    102 209.85.238.199
     99 68.180.224.225
     84 100.43.83.137
     83 208.115.111.72
     82 198.46.149.143

Top 10 запрашиваемых URL
--------------------------------------------------
    689 "http://semicomplete.com/presentations/logstash-puppetconf-2012/"
    656 "http://www.semicomplete.com/projects/xdotool/"
    406 "http://semicomplete.com/presentations/logstash-scale11x/"
    335 "http://www.semicomplete.com/articles/dynamic-dns-with-dhcp/"
    228 "http://www.semicomplete.com/"
    200 "http://www.semicomplete.com/style2.css"
    164 "http://semicomplete.com/"
    148 "http://semicomplete.com/presentations/logstash-monitorama-2013/"
    144 "http://www.semicomplete.com/blog/geekery/ssl-latency.html"
    123 "http://semicomplete.com/presentations/logstash-1/"

Ошибки веб-cервера/приложения
--------------------------------------------------
    445 304
    213 404
    164 301
      3 500
      2 416
      2 403

Список всех кодов HTTP ответа
--------------------------------------------------
   9126 200
    445 304
    213 404
    164 301
     45 206
      3 500
      2 416
      2 403
```

и высылаться на e-mail по указанному адресу